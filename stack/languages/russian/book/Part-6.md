## Часть 6

[![](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6.svg)](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6.svg)

<em>6.0 Часть 6 (кликабельно)</em>

### Создание начальных дочерних элементов

Похоже, что с элементом мы закончили, и пора переходить на его дочерние элементы. Тут два шага: их надо примонтировать (`this.mountChildren`) (1) и их надо соединить с родителем (`DOMLazyTree.queueChild`) (2). Монтирование выглядит поинтереснее, поэтому давайте перейдем к нему.

Существует отдельный модуль [ReactMultiChild](https://github.com/facebook/react/blob/v15.4.2/src/renderers/shared/stack/reconciler/ReactMultiChild.js) для управления дочерними элементами. Давайте-ка заглянем в метод `mountChildren`. В нем решаются две задачи - сначала мы создаем экземпляры дочерних элементов (используя `ReactChildReconciler), а затем монтируем их. Что может выступать в качестве дочернего элемента? Это может быть простой HTML-тэг или другой пользовательский компонент. Для работы с первыми нам нужно создавать экземпляры `ReactDOMComponent`, для работы со вторыми - `ReactCompositeComponent`. Поток выполнения монтирования при этом, опять же, будет зависеть от типа дочернего элемента.

### Еще разок

Если вы все еще читаете это, то наверное пора вспомнить и прояснить весь процесс целиком еще разок. Давайте сделаем паузу и восстановим последовательность объектов.

[![](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/overall-mounting-scheme.svg)](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/overall-mounting-scheme.svg)

<em>6.1 Общая схема монтирования (кликабельно)</em>

1) React создает экземпляры `ReactCompositeComponent` для каждого определенного вами компонента (с вызовом методов жизненного цикла, таких как `componentWillMount` и прочих) и монтирует их.

2) Во время монтирования, сначала создается экземпляр вашего компонента (вызывается конструктор)

3) Затем вызывается метод рендера (для нашего небольшого примера, рендер возвращает `div`) и `React.createElement` создает React-элементы. Этот метод может быть вызван напрямую, или после парсинга JSX Babel'ем и заменой тэгов в вашем render-метода. Но результат рендера это пока еще не совсем то, что нам нужно, смотрим ниже

4) Нам нужен DOM-компонент для нашего `div`. Поэтому в процессе создания экземпляра, мы создаем экземпляры `ReactDOMComponent` из React-элементов, упомянутых выше. 

5) Затем нужно примонтировать DOM-компонент. Это как раз и означает, что мы создаем DOM-элементы, назначаем им обработчики событий и так далее.

6) Затем, мы обрабатываем начальные дочерние элементы нашего DOM-компонента. Мы создаем их экземпляры и так же монтируем их. В зависимости от типа дочернего элемента, компонент или простой HTML-тэг, мы возвращаемся на шаг 1 или на шаг 5 соответственно. И все это повторяем для всех вложенных элементов.

Вот и все, в целом подход довольно прямолинейный.

С монтированием мы практически закончили, только поставим в очередь вызов метода `componentDidMount`... ну вот и все, отличная работа!

### Хорошо, *Часть 6* мы закончили.

Давайте вспомним, как мы сюда попали - глянем еще раз на схему, затем уберем из нее избыточные и менее важные куски, и она станет вот такой:

[![](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-A.svg)](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-A.svg)

<em>6.2 Часть 6 упрощенно (кликабельно)</em>

Уберем пустое место и поправим выравнивание:

[![](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-B.svg)](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-B.svg)

<em>6.3 Часть 6 упрощенно и с рефакторингом (кликабельно)</em>

Вот теперь отлично. По сути, это все что происходит на этой стадии. Поэтому мы возьмем эту ключевую выдержку из *Части 5* и поместим ее на итоговую схему процесса `монтирования`:

[![](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-C.svg)](https://rawgit.com/Bogdan-Lyashenko/Under-the-hood-ReactJS/master/stack/images/6/part-6-C.svg)

<em>6.4 Часть 6 клюичевые моменты (кликабельно)</em>

И мы закончили!


[На следующую страницу: Часть 7 >>](./Part-7.md)

[<< На предыдущую страницу: Часть 5](./Part-5.md)


[К оглавлению](./README.md)
